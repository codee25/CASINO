<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Імперія Слота: Віртуальне Казино</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./style.css">
    <!-- Third-party libraries that need to be globally available -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body class="flex flex-col items-center justify-between w-screen h-screen bg-gradient-to-br from-purple-900 via-gray-900 to-indigo-900 text-white overflow-hidden">
    <div id="root" class="relative w-full h-full flex flex-col items-center justify-start">
        <!-- React App will be mounted here -->
        <!-- Початковий текст для дебагу, якщо React не завантажується -->
        <p id="initialLoadingMessage" class="text-xl text-white mt-10">
            Завантаження React-додатка... Якщо ви бачите це довго, можливо, є помилка.
        </p>
    </div>
    
    <!-- React and ReactDOM scripts -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>

    <!-- Your React App component file - it will define App and UserProvider globally -->
    <script type="text/babel" data-presets="react" src="./src/App.jsx"></script>

    <!-- React App entry point: uses globally available App and UserProvider -->
    <script type="text/babel" data-presets="react">
        // Лог на самому початку цього скрипта
        if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
            Telegram.WebApp.sendData('JS_VERY_FIRST_REACT_INDEX_LOG: ReactDOM script block started.');
        } else {
            console.error("JS_VERY_FIRST_REACT_INDEX_ERROR: Telegram.WebApp not available at ReactDOM script block start.");
        }

        try {
            // Перевіряємо, чи App та UserProvider доступні глобально
            const App = window.App; // Access App globally
            const UserProvider = window.UserProvider; // Access UserProvider globally

            if (!App) {
                if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                    Telegram.WebApp.sendData('JS_ERROR: App component not available globally.');
                }
                document.getElementById('root').innerHTML = '<p class="text-red-500 text-center mt-10">Помилка: Компонент App не завантажено або недоступний.</p>';
                throw new Error("App component not available globally.");
            }
            if (!UserProvider) {
                if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                    Telegram.WebApp.sendData('JS_ERROR: UserProvider component not available globally.');
                }
                document.getElementById('root').innerHTML = '<p class="text-red-500 text-center mt-10">Помилка: Компонент UserProvider не завантажено або недоступний.</p>';
                throw new Error("UserProvider component not available globally.");
            }

            const rootElement = document.getElementById('root');
            if (!rootElement) {
                if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                    Telegram.WebApp.sendData('JS_ERROR: Root element not found.');
                }
                console.error("Error: Root element with ID 'root' not found.");
                // Немає куди монтувати React, якщо немає root елемента
            } else {
                // Прибираємо початкове повідомлення після успішного початку завантаження React
                const initialMessage = document.getElementById('initialLoadingMessage');
                if (initialMessage) {
                    initialMessage.remove();
                }

                const root = ReactDOM.createRoot(rootElement);
                root.render(
                    <React.StrictMode>
                        <UserProvider>
                            <App />
                        </UserProvider>
                    </React.StrictMode>
                );
                if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                    Telegram.WebApp.sendData('JS_LOG: React app rendered successfully.');
                }
            }
        } catch (e) {
            console.error("Error during React app initialization:", e);
            if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                Telegram.WebApp.sendData(`JS_FATAL_REACT_ERROR: ${e.message.substring(0, Math.min(e.message.length, 100))}`);
            }
            const rootElement = document.getElementById('root');
            if (rootElement) {
                rootElement.innerHTML = `<p class="text-red-500 text-center mt-10 text-lg">
                    Критична помилка завантаження гри: <br/> ${e.message}
                    <br/> Перевірте консоль браузера або логи Render.
                </p>`;
            }
        }
    </script>
</body>
</html>
