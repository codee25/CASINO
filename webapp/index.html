<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Імперія Слота: Віртуальне Казино</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./style.css">
    <!-- Third-party libraries that need to be globally available -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body class="flex flex-col items-center justify-between w-screen h-screen bg-gradient-to-br from-purple-900 via-gray-900 to-indigo-900 text-white overflow-hidden">
    <div id="root" class="relative w-full h-full flex flex-col items-center justify-start">
        <!-- React App will be mounted here -->
        <!-- Початкове повідомлення, поки React завантажується -->
        <p id="initialLoadingMessage" class="text-xl text-white mt-10">
            Завантаження гри... Будь ласка, зачекайте.
        </p>
    </div>
    
    <!-- React and ReactDOM scripts -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>

    <!-- Your React App component file - it defines App and UserProvider globally -->
    <!-- ЦЕЙ СКРИПТ ПОВИНЕН БУТИ ОБРОБЛЕНИЙ BABEL ТА ЗАВАНТАЖЕНИЙ ПЕРШИМ -->
    <script type="text/babel" data-presets="react" src="./app.jsx"></script>

    <!-- Main React App entry point: uses globally available App and UserProvider -->
    <!-- ЦЕЙ СКРИПТ ЧЕКАЄ НА ЗАВАНТАЖЕННЯ DOM ТА ГЛОБАЛЬНИХ КОМПОНЕНТІВ -->
    <script type="text/babel" data-presets="react">
        // Лог на самому початку цього скрипта
        if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
            Telegram.WebApp.sendData('JS_VERY_FIRST_REACT_INDEX_LOG: ReactDOM mount script block started.');
        } else {
            console.error("JS_VERY_FIRST_REACT_INDEX_ERROR: Telegram.WebApp not available at ReactDOM mount script block start.");
        }

        // Чекаємо, поки DOM буде повністю завантажений
        document.addEventListener('DOMContentLoaded', () => {
            const rootElement = document.getElementById('root');
            const initialMessage = document.getElementById('initialLoadingMessage');

            if (!rootElement) {
                console.error("Error: Root element with ID 'root' not found for ReactDOM.createRoot.");
                if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                    Telegram.WebApp.sendData('JS_ERROR: Root element not found for ReactDOM.');
                }
                if (initialMessage) {
                    initialMessage.textContent = 'Критична помилка: Кореневий елемент не знайдено.';
                    initialMessage.classList.add('text-red-500');
                }
                return;
            }

            // Перевіряємо, чи App та UserProvider доступні глобально
            const App = window.App; // Доступ до App глобально
            const UserProvider = window.UserProvider; // Доступ до UserProvider глобально

            if (!App || !UserProvider) {
                console.error("Error: App or UserProvider component not available globally after app.jsx load.");
                if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                    Telegram.WebApp.sendData('JS_ERROR: App/UserProvider not global after app.jsx.');
                }
                if (initialMessage) {
                    initialMessage.innerHTML = '<p class="text-red-500 text-center mt-10 text-lg">Критична помилка: Компоненти гри не завантажено. <br/> Перевірте консоль браузера або логи Render.</p>';
                }
                return;
            }
            
            // Якщо все добре, приховуємо початкове повідомлення та монтуємо React-додаток
            if (initialMessage) {
                initialMessage.remove();
            }

            const root = ReactDOM.createRoot(rootElement);
            root.render(
                <React.StrictMode>
                    <UserProvider>
                        <App />
                    </UserProvider>
                </React.StrictMode>
            );

            if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                Telegram.WebApp.sendData('JS_LOG: React app rendered successfully into DOM.');
            }
        }); // End DOMContentLoaded
    </script>
</body>
</html>
